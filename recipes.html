<!DOCTYPE html>
<html lang="en">
<head>
      <meta charset="UTF-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <title>Recipes</title>
      <link rel="stylesheet" href="styles.css"/>
</head>
<body>
<h1>Add a New Recipe</h1>

<form id="recipeForm">
      <label>
      Title:
      <input type="text" id="titleOfRecipe" required />
      </label>

      <label>
      Tags
      <button>halal</button>
      <button>vegan</button>
      <button>dessert</button>
      </label>

      <label>
      Cooking Time:
      <input type="number" id="cookingTimeOfRecipe" />
      </label>

      <label>
      Ingredients (working on it)
      <textarea id="ingredientsOfRecipe"></textarea>
      </label>

      <label>
      Instructions:
      <div id="instructionsContainer"></div>
      <button type="button" id="addStepBtn">Add Step</button>
      </label>

      <button type="submitRecipe">save recipe</button>
</form>








<script>
console.log("code updated 1");

var testing = "working";
const form = document.getElementById("recipeForm");
const instructionsContainer = document.getElementById("instructionsContainer");
const addStepBtn = document.getElementById("addStepBtn");

let stepCount = 0;

addStepBtn.addEventListener("click", addStep);

    function addStep(initialValue = "") {
      stepCount++;
      console.log("step function was activated");

      const stepDiv = document.createElement("div");
      stepDiv.classList.add("step-container");

      const stepLabel = document.createElement("div");
      stepLabel.classList.add("step-number");

      const stepInput = document.createElement("input");
      stepInput.type = "text";
      stepInput.value = initialValue;

      const removeBtn = document.createElement("button");
      removeBtn.type = "button";
      removeBtn.textContent = "X";
      removeBtn.classList.add("remove-btn")

      removeBtn.addEventListener("click", () => {
        instructionsContainer.removeChild(stepDiv);
        updateStepNumbers();
      });

      stepDiv.appendChild(stepLabel);
      stepDiv.appendChild(stepInput);
      stepDiv.appendChild(removeBtn);
      instructionsContainer.appendChild(stepDiv);
    }

    function updateStepNumbers() {
      stepCount = 0;
      instructionsContainer.querySelectorAll(".step-container").forEach((div) => {
        stepCount++;
        div.querySelector(".step-number").textContent = `Step ${stepCount}:`;
      });
    }









    form.addEventListener("submit", (e) => {
      e.preventDefault();

      const title = document.getElementById("titleOfRecipe").value.trim();
      const tagsString = document.getElementById("tags").value.trim();
      const cookingTime = document.getElementById("cookingTimeOfRecipe").value.trim();
      const ingredientsString = document.getElementById("ingredientsOfRecipe").value.trim();

      const tags = tagsString
        ? tagsString.split(",").map(tag => tag.trim()).filter(tag => tag !== "")
        : [];

      const ingredients = ingredientsString
        ? ingredientsString.split("\n").map(line => line.trim()).filter(line => line !== "")
        : [];

    
      const instructionInputs = instructionsContainer.querySelectorAll("input");
      const instructions = Array.from(instructionInputs)
        .map(input => input.value.trim())
        .filter(line => line !== "");

      const recipe = {
        title,
        tags,
        cookingTime,
        ingredients,
        instructions
      };

      const recipesRef = ref(database, "recipes");
      const newRecipeRef = push(recipesRef);

      set(newRecipeRef, recipe)
        .then(() => {
          alert("Recipe saved successfully!");
          form.reset();
          instructionsContainer.innerHTML = "";
          stepCount = 0;
          addStep(); // start fresh
        })
        .catch((error) => {
          console.error("Error saving recipe:", error);
          alert("something went wrong :(");
        });
    });
</script>



</body>
</html>