<!DOCTYPE html>
<html lang="en">
<head>
      <meta charset="UTF-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <title>fake</title>
      <link rel="stylesheet" href="styles.css"/>
</head>
<a href="mealPlans.html">hi</a>

<body data-page="r-list">
<div id="searchContainer">
      <input type="text" id="searchInputBar" placeholder="Search recipes by title..." />
      <button type="button" id="searchBtn">Search</button> 
      
      <div class="searchContDropD">

            <button type="button" id="mealFilterBtn">Meals</button>
                  <div id="mealDropD" class="filterDropDContent">
                        <button type="button" class="dropDBtn" data-tag="breakfast">Breakfast</button>
                        <button type="button" class="dropDBtn" data-tag="lunch">Lunch</button>
                        <button type="button" class="dropDBtn" data-tag="dinner">Dinner</button>
                        <button type="button" class="dropDBtn" data-tag="dessert">Dessert</button>
                        <button type="button" class="dropDBtn" data-tag="snack">Snack</button>
                        <button type="button" class="dropDBtn" data-tag="other">Other</button>
                  </div>

            <button type="button" id="dietFilterBtn">Dietary Specifications</button>
                  <div id="dietDropD" class="filterDropDContent">
                        <button type="button" class="dropDBtn" data-tag="vegetarian">Vegetarian</button>
                        <button type="button" class="dropDBtn" data-tag="vegan">Vegan</button>
                        <button type="button" class="dropDBtn" data-tag="gluten-free">Gluten-free</button>
                        <button type="button" class="dropDBtn" data-tag="halal">Halal</button>
                        <button type="button" class="dropDBtn" data-tag="kosher">Kosher</button>
                        <button type="button" class="dropDBtn" data-tag="other">Other</button>
                        <button type="button" class="dropDBtn" data-tag="none">None</button>
                  </div>      
          <div id="selectedFilters">
              <h3>Filters:</h3> <span id="filterTags">None</span>
          </div> 
      </div>
</div>


<button id="addRecpBtn">Add new recipe</button>
<div id="addRecpDropD" class="addRecpDropDContent">
      <h1>Add a New Recipe</h1>
      <br>
      <br>
      <form id="recipeForm">
            <label>
            Title:
            <input type="text" id="titleOfRecipe" required>
            </label>

            <label>
                  Meal of the day
                  <button type="button" class="tagBtn" data-tag="breakfast">Breakfast</button>
                  <button type="button" class="tagBtn" data-tag="lunch">Lunch</button>
                  <button type="button" class="tagBtn" data-tag="dinner">Dinner</button>
                  <button type="button" class="tagBtn" data-tag="dessert">Dessert</button>
                  <button type="button" class="tagBtn" data-tag="snack">Snack</button>
                  <button type="button" class="tagBtn" data-tag="other">Other</button>
            </label>    

            <label>
                  Dietary specifcations
                  <button type="button" class="dietSpefBtn" data-tag="vegetarian">Vegetarian</button>
                  <button type="button" class="dietSpefBtn" data-tag="vegan">Vegan</button>
                  <button type="button" class="dietSpefBtn" data-tag="gluten-free">Gluten-free</button>
                  <button type="button" class="dietSpefBtn" data-tag="halal">Halal</button>
                  <button type="button" class="dietSpefBtn" data-tag="kosher">Kosher</button>
                  <button type="button" class="dietSpefBtn" data-tag="other">Other</button>
                  <button type="button" class="dietSpefBtn" data-tag="none">None</button>
            </label> 

            <label>
            Prep Time:
            <input type="number" id="prepTimeOfRecipe" required> <h3>mins</h3>
            </label>

            <label>
            Cooking Time:
            <input type="number" id="cookingTimeOfRecipe"required> <h3>mins</h3>
            </label>

            <label>
            Ingredients (please insert between commas like so: a, b, c, d)
            <textarea id="ingredientsOfRecipe"></textarea>
            </label>

            <label>
            Instructions:
            <br>
            <div id="instructionsContainer"></div>
            <button type="button" id="addStepBtn">Add Step</button>
            </label>
            <button type="button" id="saveRecipeBtn">Save recipe</button>
      </form>
</div>
<br>
<br>
<h1>All recipes </h1>
<div id="pullAllRecipes"></div>



<script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-app.js";
// TODO: Add SDKs for Firebase products that you want to use
// https://firebase.google.com/docs/web/setup#available-libraries

// Your web app's Firebase configuration
const firebaseConfig = {
    apiKey: "AIzaSyDaFwUkn50NhSRt3FgS68lidSap4NqyPxk",
    authDomain: "listofrecipes-d88b8.firebaseapp.com",
    databaseURL: "https://listofrecipes-d88b8-default-rtdb.firebaseio.com",
    projectId: "listofrecipes-d88b8",
    storageBucket: "listofrecipes-d88b8.firebasestorage.app",
    messagingSenderId: "147673777707",
    appId: "1:147673777707:web:9c9a187722377fec470c6e"
};

const app = initializeApp(firebaseConfig);
import {getDatabase, set, ref, push, get, remove} 
from "https://www.gstatic.com/firebasejs/11.10.0/firebase-database.js";

const database = getDatabase(app);
const recipesRef = ref(database, "recipes");
let allRecipesList = [];


function objKeysToArray(obj) {
  return obj ? Object.keys(obj) : [];
}

console.log("code updated 133")

const tagAddBtn = document.querySelectorAll(".tagBtn");
const dietAddBtn = document.querySelectorAll(".dietSpefBtn");
const form = document.getElementById("recipeForm");
const instructCont = document.getElementById("instructionsContainer");
const addStepBtn = document.getElementById("addStepBtn");
const saveRecipeBtn = document.getElementById("saveRecipeBtn");
const pullAllRecipes = document.getElementById("pullAllRecipes");

  let tags = [];
  let dietarySpef = [];

get(recipesRef)
.then((snapshot) => {
      if (snapshot.exists()) {
            const recipes = snapshot.val();
            pullAllRecipes.innerHTML = "";
            allRecipesList = Object.entries(recipes); // store as [id, recipe] pairs

      } else {
            pullAllRecipes.innerHTML = "<p>No recipes found.</p>";
    }
})
.catch((error) => {
      console.error("Error loading recipes:", error);
});




      
function displayRecipe(recipe, ID) {
const recipeDiv = document.createElement("div");
recipeDiv.classList.add("recipe-card");
recipeDiv.innerHTML = `
          <h3>
            <a href="recipe.html?id=${ID}" target="_blank">${recipe.title}</a>
          </h3>
          <h4>Tags:</h4>
          <p>${recipe.tags.join(", ") || "None"}</p>
          <h4>Dietary Specifications:</h4>
          <p>${recipe.dietarySpef.join(", ") || "None"}</p>
          <h4>Ingredients:</h4>
          <ul>
            ${recipe.ingredients?.join("") || "<li>None</li>"}
          </ul>
          <hr>
  `   ;



const deleteBtn = recipeDiv.querySelector(".deleteRecipeBtn");

deleteBtn.addEventListener("click", () => {
if (confirm(`Are you sure you want to delete "${recipe.title}"?`)) {
const recipeRef = ref(database, "recipes/" + recipeId);
remove(recipeRef)
      .then(() => {
      alert("Recipe deleted successfully!");
      window.location.href = "recipeList.html"; // Redirect after deletion
      })
      .catch(error => {
      alert("Error deleting recipe: " + error.message);
      });
}
});


      return recipeDiv;
}



      
</script>

</body>
</html>